# MLOps Project Configuration
project:
  name: "torob-rag-system"
  phase: 1
  seed: 42

data:
  raw_path: "../Data/"
  processed_path: "../Data/processed/"
  tables:
    - "base_products"
    - "members"
    - "searches"
    - "base_views"
    - "final_clicks"
    - "shops"
    - "categories"
    - "brands"
    - "cities"

eda:
  output_dir: "../reports/eda/"
  generate_profile: true
  plot_distributions: true
  
cleaning:
  placeholder_tokens: ['none', 'null', 'nan', 'n/a', 'na', '-', '--', 'unknown', '?']
  price_min: 1000  # Minimum valid price (1,000 Toman)
  price_max: 1000000000000  # Maximum valid price (1 Trillion Toman)
  remove_zero_prices: true
  missing_threshold: 0.3  # Drop columns with >30% missing
  remove_duplicates: true

feature_engineering:
  sample_size: 5000  # Set to null for full dataset processing
  
  text:
    # Compact sentence embedding model (English-focused, no prefixes needed)
    # Note: For better Persian support, consider using multilingual-e5-base
    model_name: "sentence-transformers/all-MiniLM-L12-v2"
    max_length: 128
    batch_size: 64  # Increased from 32 for better GPU utilization
  
  image:
    model_name: "openai/clip-vit-base-patch32"
    image_size: 224
    batch_size: 32  # Increased from 16 for better GPU utilization
    cache_dir: "../outputs/image_cache/"
    download_timeout: 15  # seconds
  
  multimodal:
    fusion_method: "concatenation"  # Options: concatenation, attention, projection

outputs:
  embeddings_dir: "../outputs/embeddings/"
  models_dir: "../outputs/models/"
  image_cache_dir: "../outputs/image_cache/"

vector_db:
  type: "chromadb"
  persist_directory: "../outputs/vector_db/"
  collections:
    text: "products_text"
    image: "products_image"
    multimodal: "products_multimodal"
  distance_metric: "cosine"

retrieval:
  top_k: 10
  rerank: true
  
evaluation:
  test_dataset_size: 300  # Number of test queries for evaluation
  metrics:
    - "ndcg@10"
    - "recall@10"
    - "mrr"
  test_split: 0.2
  noise:
    text:
      level: 0.08  # Character-level noise ratio (8% for robust testing)
    image:
      # Ranges for random uniform sampling: [min, max]
      blur: [1.0, 3.5]  # Gaussian blur radius range
      brightness: [0.5, 1.5]  # Brightness enhancement factor range
      contrast: [0.6, 1.4]  # Contrast enhancement factor range
      rotation: [-25, 25]  # Rotation angle range in degrees
      color: [0.5, 1.5]  # Color saturation factor range

hyperparameter_tuning:
  n_trials: 20  # Number of Optuna optimization trials
  k_value: 10  # Fixed k for retrieval during tuning
  alpha_min: 0.0  # Minimum alpha (text weight)
  alpha_max: 1.0  # Maximum alpha (text weight)
  objective: "category_hit_rate"  # Options: mrr, precision, category_hit_rate
  
experiment_tracking:
  use_mlflow: true
  tracking_uri: "../mlruns/"
  experiment_name: "torob-rag-phase1"

# Data versioning
data_versioning:
  enabled: true
  version_file: "../outputs/data_version.json"
  track:
    - "data_hash"
    - "preprocessing_timestamp"
    - "embeddings_timestamp"
    - "model_versions"
    - "config_snapshot"

# Global random seed for reproducibility
random_seed: 42
